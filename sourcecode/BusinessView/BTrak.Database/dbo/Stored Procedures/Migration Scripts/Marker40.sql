CREATE PROCEDURE [dbo].[Marker40]
(
    @CompanyId UNIQUEIDENTIFIER,
    @UserId UNIQUEIDENTIFIER,
    @RoleId UNIQUEIDENTIFIER
)
AS 
BEGIN 

	MERGE INTO [dbo].[Widget] AS Target 
	USING ( VALUES 
        (NEWID(), N'This app is used to configure induction tasks which are used while creating a user. The tasks which were created here are dispalyed as default tasks while creating a user. Here we can sort, filter and delete induction tasks',N'Induction configurations', GETDATE(),@UserId,@CompanyId,NULL,NULL,NULL)
        )
	AS Source ([Id], [Description], [WidgetName], [CreatedDateTime],[CreatedByUserId],[CompanyId],[UpdatedDateTime],[UpdatedByUserId],[InActiveDateTime]) 
	ON Target.Id = Source.Id 
	WHEN MATCHED THEN 
	UPDATE SET [WidgetName] = Source.[WidgetName],
			   [Description] = Source.[Description],
	           [CreatedDateTime] = Source.[CreatedDateTime],
	           [CreatedByUserId] = Source.[CreatedByUserId],
	           [CompanyId] =  Source.[CompanyId],
	           [UpdatedDateTime] =  Source.[UpdatedDateTime],
	           [UpdatedByUserId] =  Source.[UpdatedByUserId],
	           [InActiveDateTime] =  Source.[InActiveDateTime]
	WHEN NOT MATCHED BY TARGET THEN 
	INSERT ([Id], [Description], [WidgetName], [CreatedDateTime],[CreatedByUserId],[CompanyId],[UpdatedDateTime],[UpdatedByUserId],[InActiveDateTime]) 
	VALUES ([Id], [Description], [WidgetName], [CreatedDateTime],[CreatedByUserId],[CompanyId],[UpdatedDateTime],[UpdatedByUserId],[InActiveDateTime]);
	
		MERGE INTO [dbo].[CustomWidgets] AS Target 
		USING ( VALUES 
		      (NEWID(), N'Completed induction stories percentage', N'This app displays the percentage of completion of induction stories in the company and also users can change the visualization'
			  ,'SELECT CONVERT(FLOAT,ROUND(ISNULL( ((SELECT COUNT(1) TotalCount FROM UserStory US WHERE US.ProjectId = (SELECT Id FROM Project WHERE CompanyId = ''@CompanyId'' AND ProjectName = ''Induction project'') AND US.UserStoryStatusId = (SELECT Id FROM UserStoryStatus WHERE [Status] = ''Completed'' AND CompanyId = ''@CompanyId'')) * 100.00 / IIF(ISNULL((SELECT COUNT(1) TotalCount FROM UserStory US WHERE US.ProjectId = (SELECT Id FROM Project WHERE CompanyId = ''@CompanyId'' AND ProjectName = ''Induction project'')) * 1.0,0) = 0,1,(SELECT COUNT(1) TotalCount FROM UserStory US WHERE US.ProjectId = (SELECT Id FROM Project WHERE CompanyId = ''@CompanyId'' AND ProjectName = ''Induction project'')) * 1.0) ),0),2)) AS Total',0, @CompanyId, @UserId, GETDATE())
			  ,(NEWID(), N'Completed vs total induction stories', N'This app is used to display the counts related to induction work assigned to users. In this app we display the completed induction stories count vs total induction stories count of a company'
			 ,' SELECT CONVERT(NVARCHAR,ISNULL((SELECT COUNT(1) TotalCount FROM UserStory US  WHERE US.ProjectId = (SELECT Id FROM Project WHERE CompanyId = ''@CompanyId'' AND ProjectName = ''Induction project'') AND US.UserStoryStatusId = (SELECT Id FROM UserStoryStatus WHERE [Status] = ''Completed'' AND CompanyId = ''@CompanyId'')),0)) + ''/'' + CONVERT(NVARCHAR,ISNULL((SELECT COUNT(1) TotalCount FROM UserStory US  WHERE US.ProjectId = (SELECT Id FROM Project WHERE CompanyId = ''@CompanyId'' AND ProjectName = ''Induction project'')),0)) AS Total',0, @CompanyId, @UserId, GETDATE())
		)
		AS Source ([Id], [CustomWidgetName], [Description],[WidgetQuery],[IsProc], [CompanyId],[CreatedByUserId], [CreatedDateTime])
		ON Target.Id = Source.Id
		WHEN NOT MATCHED BY TARGET THEN 
		INSERT  ([Id], [CustomWidgetName], [Description],[WidgetQuery],[IsProc] , [CompanyId],[CreatedByUserId], [CreatedDateTime]) 
		VALUES	([Id], [CustomWidgetName], [Description],[WidgetQuery],[IsProc] , [CompanyId],[CreatedByUserId], [CreatedDateTime]);
			
	MERGE INTO [dbo].[CustomAppDetails] AS Target 
		USING ( VALUES 
		(NEWID(),(SELECT Id FROM CustomWidgets WHERE CompanyId = @CompanyId AND InActiveDateTime IS NULL AND CustomWidgetName = 'Completed induction stories percentage'),'1','Completed induction stories percentage_kpi','kpi','Total',GETDATE(),@UserId)
		,(NEWID(),(SELECT Id FROM CustomWidgets WHERE CompanyId = @CompanyId AND InActiveDateTime IS NULL AND CustomWidgetName = 'Completed vs total induction stories'),'1','Completed vs total induction stories_kpi','kpi','Total',GETDATE(),@UserId)
		)
		AS Source ([Id], [CustomApplicationId], [IsDefault], [VisualizationName],[visualizationType],[YCoOrdinate],[CreatedDateTime], [CreatedByUserId])
		ON Target.Id = Source.Id
		WHEN NOT MATCHED BY TARGET THEN 
		INSERT  ([Id], [CustomApplicationId], [IsDefault], [VisualizationName],[visualizationType],[YCoOrdinate],[CreatedDateTime], [CreatedByUserId]) 
	VALUES	([Id], [CustomApplicationId], [IsDefault], [VisualizationName],[visualizationType],[YCoOrdinate],[CreatedDateTime], [CreatedByUserId]);
	
	MERGE INTO [dbo].PerformanceConfiguration AS Target
	USING ( VALUES
	       (NEWID(), N'Review form 1',0, @RoleId, N'{"components":[{"label":"Job knowledge","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"jobKnowledge","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false},{"label":"Score (Job knowledge)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Quality of work","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"qualityOfWork","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false},{"label":"Score (Quality of work)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score2","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Quantity of work","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"quantityOfWork","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score (Quantity of work)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score3","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Reliability","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"reliability","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score (Reliability)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score4","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Initiative and creativity","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"initiativeAndCreativity","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score (Initiative and creativity)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score5","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Judgment","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"judgment","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score (Judgement)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score6","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Cooperation","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"cooperation","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score (Cooperation)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score7","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Attendance","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"cooperation2","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false},{"label":"Score (Attendance)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score8","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Planning and organizing","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"planningAndOrganizing","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score (Planning and organizing)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score9","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Directing and controlling","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"planningAndOrganizing2","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false},{"label":"Score (Directing and controlling)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score10","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Decision-making","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"planningAndOrganizing3","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false},{"label":"Score (Decision making)","mask":false,"tableView":true,"alwaysEnabled":false,"type":"select","input":true,"key":"score11","defaultValue":"","validate":{"select":false,"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"data":{"values":[{"label":"1","value":"1"},{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"4","value":"4"},{"label":"5","value":"5"}]},"valueProperty":"value","selectThreshold":0.3,"encrypted":false,"lazyLoad":false,"selectValues":"","disableLimit":false,"sort":"","reference":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"reorder":false},{"label":"Comments","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"comments","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"type":"button","label":"Submit","key":"submit","disableOnInvalid":true,"theme":"primary","input":true,"tableView":true}]}', @CompanyId, GetDate(), @UserId)
		  ,(NEWID(), N'Review form 2',0, @RoleId, N'{"components":[{"label":"1. Strategic & Critical Thinking","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"1StrategicCriticalThinking","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score","mask":false,"tableView":true,"alwaysEnabled":false,"type":"number","input":true,"key":"score","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"reorder":false,"delimiter":false,"requireDecimal":false,"encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"2. Creativity & Innovation","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"2FindingSolutions","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false},{"label":"Score","mask":false,"tableView":true,"alwaysEnabled":false,"type":"number","input":true,"key":"score2","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"reorder":false,"delimiter":false,"requireDecimal":false,"encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"3. Culture and Values","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"3FindingSolutions","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false},{"label":"Score","mask":false,"tableView":true,"alwaysEnabled":false,"type":"number","input":true,"key":"score3","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"reorder":false,"delimiter":false,"requireDecimal":false,"encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"4. Productivity","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"4Productivity","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score","mask":false,"tableView":true,"alwaysEnabled":false,"type":"number","input":true,"key":"score4","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"reorder":false,"delimiter":false,"requireDecimal":false,"encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"5. Job Knowledge","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"5JobKnowledge","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score","mask":false,"tableView":true,"alwaysEnabled":false,"type":"number","input":true,"key":"score5","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"reorder":false,"delimiter":false,"requireDecimal":false,"encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"6. Quality & Dependability","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"6QualityDependability","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score","mask":false,"tableView":true,"alwaysEnabled":false,"type":"number","input":true,"key":"score6","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"reorder":false,"delimiter":false,"requireDecimal":false,"encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"7. Teamwork & Leadership","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"7TeamworkLeadership","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Score","mask":false,"tableView":true,"alwaysEnabled":false,"type":"number","input":true,"key":"score7","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"reorder":false,"delimiter":false,"requireDecimal":false,"encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"label":"Comments","autoExpand":false,"isUploadEnabled":false,"showWordCount":false,"showCharCount":false,"tableView":true,"alwaysEnabled":false,"type":"textarea","input":true,"key":"comments","defaultValue":"","validate":{"customMessage":"","json":""},"conditional":{"show":"","when":"","json":""},"uploadUrl":"","uploadOptions":"","uploadDir":"","reorder":false,"inputFormat":"plain","encrypted":false,"properties":{},"customConditional":"","logic":[],"attributes":{}},{"type":"button","label":"Submit","key":"submit","disableOnInvalid":true,"theme":"primary","input":true,"tableView":true}]}', @CompanyId, GetDate(), @UserId)
		  )
	AS Source ([Id], [Name], [IsDraft], [SelectedRoles], [FormJson], [CompanyId], [CreatedDateTime], [CreatedByUserId])
	ON Target.Id = Source.Id
	WHEN MATCHED THEN
	UPDATE SET [Name] = Source.[Name],
			   [IsDraft] = source.[IsDraft],
			   [SelectedRoles] = source.[SelectedRoles],
			   [FormJson] = source.[FormJson],
			   [CompanyId] = source.[CompanyId],
			   [CreatedDateTime] = Source.[CreatedDateTime],
	           [CreatedByUserId] = Source.[CreatedByUserId]
	WHEN NOT MATCHED BY TARGET THEN
	INSERT ([Id], [Name], [IsDraft], [SelectedRoles], [FormJson], [CompanyId], [CreatedDateTime], [CreatedByUserId]) VALUES ([Id], [Name], [IsDraft], [SelectedRoles], [FormJson], [CompanyId], [CreatedDateTime], [CreatedByUserId]);
	
	--Script to insert induction workflow
	
	MERGE INTO [dbo].[Project] AS Target 
	USING (VALUES 
			 (NEWID(),@CompanyId, N'Induction project',CAST(N'2019-07-08T12:12:41.667' AS DateTime), @UserId,NULL)
			)
	AS Source ([Id], [CompanyId], [ProjectName], [CreatedDateTime], [CreatedByUserId], [InactiveDateTime])
	ON Target.Id = Source.Id  
	WHEN MATCHED THEN 
	UPDATE SET
			   [CompanyId] = Source.[CompanyId],
			   [ProjectName] = Source.[ProjectName],
			   [CreatedDateTime] = Source.[CreatedDateTime],
			   [CreatedByUserId] = Source.[CreatedByUserId],
			   [InactiveDateTime] = Source.[InactiveDateTime]
	WHEN NOT MATCHED BY TARGET THEN 
	INSERT ([Id], [CompanyId], [ProjectName], [CreatedDateTime], [CreatedByUserId],[InactiveDateTime]) 
	VALUES ([Id], [CompanyId], [ProjectName],[CreatedDateTime], [CreatedByUserId],[InactiveDateTime]);	
	
	MERGE INTO [dbo].[Goal] AS Target 
	USING (VALUES 
			 (NEWID(), (SELECT Id FROM Project WHERE CompanyId = @CompanyId AND ProjectName = 'Induction project'),(SELECT Id FROM [dbo].[BoardType] WHERE [BoardTypeName] = N'SuperAgile' AND CompanyId = @CompanyId), N'Induction Goal',N'Induction Goal', 0,@UserId, GETDATE(),@UserId, NULL,'Induction')
			)
	AS Source ([Id], [ProjectId],[BoardTypeId],[GoalName],[GoalShortName], [IsLocked],[GoalResponsibleUserId], [CreatedDateTime], [CreatedByUserId],[InactiveDateTime],[GoalUniqueName])
	ON Target.Id = Source.Id  
	WHEN MATCHED THEN 
	UPDATE SET
			   [ProjectId] = Source.[ProjectId],
			   [GoalName] = Source.[GoalName],
			   [GoalShortName] = Source.[GoalShortName],
			   [GoalResponsibleUserId] = Source.[GoalResponsibleUserId],
			   [BoardTypeId] = Source.[BoardTypeId],
			   [IsLocked] = Source.[IsLocked],
			   [CreatedDateTime] = Source.[CreatedDateTime],
			   [CreatedByUserId] = Source.[CreatedByUserId],
			   [InactiveDateTime] = Source.[InactiveDateTime],
			   [GoalUniqueName] = Source.[GoalUniqueName]
	WHEN NOT MATCHED BY TARGET THEN 
	INSERT ([Id], [ProjectId],[BoardTypeId], [GoalName],[GoalShortName], [IsLocked],[GoalResponsibleUserId], [CreatedDateTime], [CreatedByUserId],[InactiveDateTime],[GoalUniqueName]) 
	VALUES ([Id], [ProjectId],[BoardTypeId], [GoalName],[GoalShortName], [IsLocked],[GoalResponsibleUserId],[CreatedDateTime], [CreatedByUserId],[InactiveDateTime],[GoalUniqueName]);		
	
	MERGE INTO [dbo].InductionConfiguration AS Target
		USING ( VALUES
		       (NEWID(), N'Check the education details are correct and valid',0, @CompanyId, GetDate(), @UserId)
			  ,(NEWID(), N'Check the work experience details are correct and valid',0, @CompanyId, GetDate(), @UserId)
			  ,(NEWID(), N'Schedule a probation review interview',0, @CompanyId, GetDate(), @UserId)
			  ,(NEWID(), N'Check the signed contract of employment has been received',0, @CompanyId, GetDate(), @UserId)
		)
		AS Source ([Id], InductionName, [IsShow], [CompanyId], [CreatedDateTime], [CreatedByUserId])
		ON Target.Id = Source.Id
		WHEN MATCHED THEN
		UPDATE SET InductionName = Source.InductionName,
				   [IsShow] = source.[IsShow],
				   [CompanyId] = source.[CompanyId],
				   [CreatedDateTime] = Source.[CreatedDateTime],
		           [CreatedByUserId] = Source.[CreatedByUserId]
				   
		WHEN NOT MATCHED BY TARGET THEN
		INSERT ([Id], InductionName, [IsShow], [CompanyId], [CreatedDateTime], [CreatedByUserId]) VALUES ([Id], InductionName, [IsShow], [CompanyId], [CreatedDateTime], [CreatedByUserId]);	

END
GO